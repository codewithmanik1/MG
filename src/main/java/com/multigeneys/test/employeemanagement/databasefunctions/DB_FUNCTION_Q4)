-- FUNCTION: public.fn_get_all_employee_by_department_id(bigint)

-- DROP FUNCTION IF EXISTS public.fn_get_all_employee_by_department_id(bigint);

CREATE OR REPLACE FUNCTION public.fn_get_all_employee_by_department_id(
	departmentid bigint)
    RETURNS TABLE(srno bigint, id bigint, empname character varying, empdep character varying, empdesignation character varying, empsalary double precision, status boolean)
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$
BEGIN
    RETURN QUERY
    SELECT
        ROW_NUMBER() OVER (ORDER BY employee.id DESC) AS srNo,
        employee.id AS id,
        employee.employee_name AS empName,
        dep.department AS empDep,
        d.designation AS empDesignation,
        sal.salary AS empSalary,
        employee.is_active AS status
    FROM employee
    LEFT JOIN designation d ON employee.designation_id = d.id
    LEFT JOIN department dep ON employee.department_id = dep.id
    LEFT JOIN salary sal ON employee.salary_id = sal.id
    WHERE employee.is_delete = FALSE
      AND (departmentId IS NULL OR employee.department_id = departmentId);
END;
$BODY$;

ALTER FUNCTION public.fn_get_all_employee_by_department_id(bigint)
    OWNER TO postgres;
